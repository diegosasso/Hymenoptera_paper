---
title: "Disparity and correlations"
date: "`r Sys.Date()`"
output: 
  html_document:
    df_print: paged
---



```{r setup, include=F}
library(ape)
library(phytools)
library(ontophylo)
library(dplyr)
library(parallel)
library(viridis)
library(ggplot2)
library(abind)
library(dplyr)
library(purrr)
library(readr)
library(tidyr)
library(stringr)
library(deeptime)
source("R/utils-ST.R")
source('R/region_class.R')


knitr::opts_chunk$set(
  echo = TRUE,       # show code by default
  warning = FALSE,
  message = FALSE
)
```




## Read data

```{r}

# # Neff
# neff_repl <- read_rds('data_out/neff-per-replicate.RDS')
# head(neff_repl)
# 
# # Pyrate div
# div_sum <- read_rds('data_out/pyrate-dive.RDS')
# head(div_sum)

# Disparity
# dis_tb <- readRDS("data_out/data_disparity_final.RDS")
# dis_tb <- readRDS("data_out/data_disparity_frechet.RDS")
dis_tb <- readRDS("data_out/data_disparity_var-hm.RDS")
head(dis_tb)

# Rate thru time
rates_thru_time <- readRDS('data_out/rates-thru-time.RDS')
head(rates_thru_time)
```
## Plot N lineages

```{r}
plot(dis_tb$Time, dis_tb$N_Lineages, xlim=c(280,0))
max(dis_tb$N_Lineages)
```


## Plot mean Normalized Disparity

```{r}
p <- ggplot() +
  geom_ribbon(data = dis_tb, aes(x = Time, ymin = Low_CI_norm_disparity, ymax = High_CI_norm_disparity),
              fill = "black", alpha = 0.2) +
  scale_x_reverse(breaks = seq(0, 280, by = 50)) +
  geom_line(data = dis_tb, aes(x = Time, y = Mean_norm_disparity),
            color = "black", size = .3) +
  theme_minimal()

p
ggsave("figures/metrics_thru_time/disp-thru-time.pdf", p, width = 3.5*2, height = 1.6*2, dpi = 300, units = "in")
```



## Plot mean Unnormalized Disparity

```{r}
p <- ggplot() +
  geom_ribbon(data = dis_tb, aes(x = Time, ymin = Low_CI_disparity, ymax = High_CI_disparity),
              fill = "black", alpha = 0.2) +
  scale_x_reverse(breaks = seq(0, 280, by = 50)) +
  geom_line(data = dis_tb, aes(x = Time, y = Mean_disparity),
            color = "black", size = .3) +
  theme_minimal()

p
ggsave("figures/metrics_thru_time/disp-unnorm-thru-time.pdf", p, width = 3.5*2, height = 1.6*2, dpi = 300, units = "in")
```

## Correlations

```{r}

```


